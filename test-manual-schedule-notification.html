<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Manual Schedule Notification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .animate-pulse-slow {
            animation: pulse-slow 2s ease-in-out infinite;
        }

        /* AI Chat Styles */
        .chat-icon {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .chat-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }

        .chat-container {
            position: fixed;
            bottom: 90px;
            left: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 1001;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-input-container {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #007bff;
            color: white;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e9ecef;
        }

        .typing-indicator {
            display: none;
            padding: 10px 15px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 18px;
            max-width: 80%;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üß™ Manual Schedule Notification Test</h1>
            <p class="text-gray-600">Test the notification system and performance for manual schedule assignments</p>
        </div>

        <!-- Test Controls -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Test Controls</h2>
            
            <!-- Current User Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Test Agent:</label>
                <select id="agent-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">Loading agents...</option>
                </select>
            </div>

            <!-- Test Account Input -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Test Account Name:</label>
                <input type="text" id="account-input" value="TEST_ACCOUNT_001" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                       placeholder="Enter account name for testing">
            </div>

            <!-- Test Buttons -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="testFullScreenPopup()" 
                        class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105">
                    üéØ Test Full-Screen Popup (8:25 AM Style)
                </button>
                <button onclick="testBannerNotification()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105">
                    üì¢ Test Banner Notification
                </button>
                <button onclick="testActualAssignment()" 
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105">
                    ‚úÖ Create Test Assignment in DB
                </button>
                <button onclick="clearTestData()"
                        class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105">
                    üóëÔ∏è Clear Test Assignments
                </button>
                <button onclick="testFireworksEffect()"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105">
                    üéÜ Test Fireworks Effect
                </button>
                <button onclick="testCompletionCelebration()"
                        class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all transform hover:scale-105">
                    üéâ Test Completion Celebration
                </button>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Performance Metrics</h2>
            <div id="performance-metrics" class="space-y-2 text-sm">
                <p class="text-gray-600">No tests run yet...</p>
            </div>
        </div>

        <!-- Test Log -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Test Log</h2>
            <div id="test-log" class="bg-gray-50 rounded-lg p-4 h-64 overflow-y-auto font-mono text-xs">
                <p class="text-gray-500">Waiting for tests...</p>
            </div>
        </div>
    </div>

    <!-- AI Chat Interface -->
    <div class="chat-icon" id="chat-icon" onclick="toggleChat()">
        <svg width="30" height="30" fill="white" viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
        </svg>
    </div>

    <div class="chat-container" id="chat-container">
        <div class="chat-header">
            <div>
                <h3 class="font-semibold">ü§ñ AI Assistant</h3>
                <p class="text-sm opacity-90">Ask me anything about the system</p>
            </div>
            <button onclick="toggleChat()" class="text-white hover:text-gray-200">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>

        <div class="chat-messages" id="chat-messages">
            <div class="message bot">
                <div class="message-content">
                    üëã Hello! I'm your AI assistant. I can help you with questions about the dashboard, tickets, templates, and system features. What would you like to know?
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typing-indicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="flex gap-2">
                <input type="text" id="chat-input" placeholder="Type your message..."
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       onkeypress="handleChatKeyPress(event)">
                <button onclick="sendMessage()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://pfbxtbydrjcmqlrklsdr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBmYnh0YnlkcmpjbXFscmtsc2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5ODM2NDksImV4cCI6MjA3MjU1OTY0OX0.bOgnown0UZzstbnYfUSEImwaSGP6lg2FccRg-yDFTPU';

        let supabase;
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            log('‚úÖ Supabase client initialized');
        } catch (error) {
            log('‚ùå Error initializing Supabase: ' + error.message, 'error');
        }

        // Load agents on page load
        window.addEventListener('load', async () => {
            await loadAgents();
        });

        async function loadAgents() {
            try {
                const { data, error } = await supabase
                    .from('vcn_agent')
                    .select('stt, name')
                    .eq('status', 'active')
                    .order('name');

                if (error) throw error;

                const select = document.getElementById('agent-select');
                select.innerHTML = '<option value="">Select an agent...</option>' +
                    data.map(agent => `<option value="${agent.stt}">${agent.name} (ID: ${agent.stt})</option>`).join('');
                
                log(`‚úÖ Loaded ${data.length} agents`);
            } catch (error) {
                log('‚ùå Error loading agents: ' + error.message, 'error');
            }
        }

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-600' : type === 'success' ? 'text-green-600' : 'text-gray-700';
            
            const entry = document.createElement('p');
            entry.className = color;
            entry.textContent = `[${timestamp}] ${message}`;
            
            if (logDiv.firstChild?.textContent === 'Waiting for tests...') {
                logDiv.innerHTML = '';
            }
            
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateMetrics(metricName, value) {
            const metricsDiv = document.getElementById('performance-metrics');
            if (metricsDiv.firstChild?.textContent === 'No tests run yet...') {
                metricsDiv.innerHTML = '';
            }
            
            const metric = document.createElement('p');
            metric.className = 'text-gray-700';
            metric.innerHTML = `<strong>${metricName}:</strong> ${value}`;
            metricsDiv.appendChild(metric);
        }

        function testFullScreenPopup() {
            const startTime = performance.now();
            log('üéØ Testing full-screen popup...');
            
            const accountName = document.getElementById('account-input').value || 'TEST_ACCOUNT';
            
            const popup = document.createElement('div');
            popup.id = 'manual-schedule-popup';
            popup.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[10000]';
            popup.innerHTML = `
                <div class="bg-gradient-to-br from-orange-500 to-red-600 p-12 rounded-3xl shadow-2xl max-w-2xl text-center transform scale-100 animate-pulse-slow">
                    <div class="text-8xl mb-6">üìã</div>
                    <h1 class="text-5xl font-bold text-white mb-4">Manual Schedule Assignment</h1>
                    <p class="text-2xl text-orange-100 mb-6">You have been assigned to work on:</p>
                    <div class="bg-white bg-opacity-20 rounded-xl p-6 mb-8">
                        <p class="text-4xl font-bold text-white">${accountName}</p>
                    </div>
                    <p class="text-xl text-orange-200 mb-8">Please start your work for today!</p>
                    <button onclick="closeTestPopup()"
                            class="bg-white text-orange-600 px-8 py-4 rounded-full text-xl font-bold hover:bg-orange-50 transition-all transform hover:scale-105 shadow-lg">
                        Got it! Let's start üöÄ
                    </button>
                </div>
            `;
            document.body.appendChild(popup);
            
            const endTime = performance.now();
            const renderTime = (endTime - startTime).toFixed(2);
            
            log(`‚úÖ Full-screen popup rendered in ${renderTime}ms`, 'success');
            updateMetrics('Popup Render Time', `${renderTime}ms`);
        }

        function testBannerNotification() {
            const startTime = performance.now();
            log('üì¢ Testing banner notification...');
            
            // Remove existing banner if any
            const existingBanner = document.getElementById('manual-reschedule-banner');
            if (existingBanner) existingBanner.remove();
            
            const accountName = document.getElementById('account-input').value || 'TEST_ACCOUNT';
            
            const banner = document.createElement('div');
            banner.id = 'manual-reschedule-banner';
            banner.className = 'bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 mb-4 rounded-lg shadow-lg border-l-4 border-orange-600 fixed top-4 left-1/2 transform -translate-x-1/2 z-50 max-w-2xl w-full mx-4';
            banner.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">üìã</div>
                        <div>
                            <h3 class="font-bold text-lg">Manual Schedule Assignment</h3>
                            <p class="text-orange-100">You have been assigned to work on manual schedule today.</p>
                            <p class="text-sm text-orange-200">Account: <span class="font-semibold">${accountName}</span></p>
                        </div>
                    </div>
                    <button onclick="dismissTestBanner()"
                            class="bg-orange-600 text-white px-3 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                        ‚úï
                    </button>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            const endTime = performance.now();
            const renderTime = (endTime - startTime).toFixed(2);
            
            log(`‚úÖ Banner notification rendered in ${renderTime}ms`, 'success');
            updateMetrics('Banner Render Time', `${renderTime}ms`);
        }

        async function testActualAssignment() {
            const agentId = document.getElementById('agent-select').value;
            const accountName = document.getElementById('account-input').value;
            
            if (!agentId) {
                alert('Please select an agent first!');
                return;
            }
            
            if (!accountName) {
                alert('Please enter an account name!');
                return;
            }
            
            try {
                const startTime = performance.now();
                log('‚úÖ Creating test assignment in database...');
                
                const today = new Date().toISOString().split('T')[0];
                
                const { data, error } = await supabase
                    .from('schedule_assignments')
                    .insert({
                        assignment_date: today,
                        agent_id: parseInt(agentId),
                        account_export_name: accountName,
                        assignment_type: 'manual',
                        status: 'assigned'
                    })
                    .select();
                
                if (error) throw error;
                
                const endTime = performance.now();
                const dbTime = (endTime - startTime).toFixed(2);
                
                log(`‚úÖ Test assignment created successfully in ${dbTime}ms`, 'success');
                log(`   Assignment ID: ${data[0].id}`, 'success');
                updateMetrics('DB Insert Time', `${dbTime}ms`);
                
            } catch (error) {
                log('‚ùå Error creating assignment: ' + error.message, 'error');
            }
        }

        async function clearTestData() {
            if (!confirm('Are you sure you want to clear all test assignments for today?')) {
                return;
            }
            
            try {
                log('üóëÔ∏è Clearing test assignments...');
                
                const today = new Date().toISOString().split('T')[0];
                
                const { error } = await supabase
                    .from('schedule_assignments')
                    .delete()
                    .eq('assignment_date', today)
                    .eq('assignment_type', 'manual');
                
                if (error) throw error;
                
                log('‚úÖ Test assignments cleared successfully', 'success');
                
            } catch (error) {
                log('‚ùå Error clearing assignments: ' + error.message, 'error');
            }
        }

        function closeTestPopup() {
            const popup = document.getElementById('manual-schedule-popup');
            if (popup) {
                popup.remove();
                log('‚úÖ Popup closed by user');
            }
        }

        function dismissTestBanner() {
            const banner = document.getElementById('manual-reschedule-banner');
            if (banner) {
                banner.remove();
                log('‚úÖ Banner dismissed by user');
            }
        }

        // Fireworks celebration effect (same as dashboard)
        function showFireworksEffect() {
            const startTime = performance.now();
            log('üéÜ Starting fireworks effect...');

            // Create fireworks container
            const fireworksContainer = document.createElement('div');
            fireworksContainer.id = 'fireworks-container';
            fireworksContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 10000;
                pointer-events: none;
                overflow: hidden;
            `;

            // Vietnamese congratulations messages
            const messages = [
                'Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ ticket! üéâ',
                'Xu·∫•t s·∫Øc! B·∫°n ƒë√£ x·ª≠ l√Ω xong to√†n b·ªô c√¥ng vi·ªác! üåü',
                'Tuy·ªát v·ªùi! Kh√¥ng c√≤n ticket n√†o c·∫ßn x·ª≠ l√Ω! üéä',
                'Ho√†n h·∫£o! B·∫°n ƒë√£ l√†m vi·ªác r·∫•t t·ªët h√¥m nay! ‚ú®',
                'Ch√∫c m·ª´ng! T·∫•t c·∫£ ticket ƒë√£ ƒë∆∞·ª£c gi·∫£i quy·∫øt! üéà'
            ];

            const randomMessage = messages[Math.floor(Math.random() * messages.length)];

            // Create message overlay
            const messageOverlay = document.createElement('div');
            messageOverlay.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 30px 50px;
                border-radius: 20px;
                font-size: 24px;
                font-weight: bold;
                text-align: center;
                backdrop-filter: blur(10px);
                border: 2px solid #ffd700;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
                animation: messageGlow 2s ease-in-out infinite alternate;
            `;
            messageOverlay.textContent = randomMessage;

            // Add CSS animation for message glow
            const style = document.createElement('style');
            style.textContent = `
                @keyframes messageGlow {
                    from { box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
                    to { box-shadow: 0 0 50px rgba(255, 215, 0, 0.8); }
                }
                @keyframes firework {
                    0% { transform: scale(0) rotate(0deg); opacity: 1; }
                    50% { transform: scale(1) rotate(180deg); opacity: 1; }
                    100% { transform: scale(1.5) rotate(360deg); opacity: 0; }
                }
                .firework {
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    border-radius: 50%;
                    animation: firework 1.5s ease-out forwards;
                }
            `;
            document.head.appendChild(style);

            fireworksContainer.appendChild(messageOverlay);

            // Create fireworks particles
            function createFirework(x, y) {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
                const particleCount = 12;

                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'firework';
                    particle.style.cssText = `
                        left: ${x}px;
                        top: ${y}px;
                        background-color: ${colors[Math.floor(Math.random() * colors.length)]};
                        animation-delay: ${Math.random() * 0.5}s;
                        transform-origin: center;
                    `;

                    // Random direction for particles
                    const angle = (360 / particleCount) * i;
                    const distance = 50 + Math.random() * 100;
                    particle.style.setProperty('--end-x', `${Math.cos(angle * Math.PI / 180) * distance}px`);
                    particle.style.setProperty('--end-y', `${Math.sin(angle * Math.PI / 180) * distance}px`);

                    fireworksContainer.appendChild(particle);

                    // Remove particle after animation
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 2000);
                }
            }

            // Create multiple fireworks at random positions
            function launchFireworks() {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const x = Math.random() * window.innerWidth;
                        const y = Math.random() * window.innerHeight;
                        createFirework(x, y);
                    }, i * 300);
                }
            }

            document.body.appendChild(fireworksContainer);

            // Launch fireworks multiple times
            launchFireworks();
            setTimeout(launchFireworks, 1000);
            setTimeout(launchFireworks, 2000);

            // Remove fireworks after 5 seconds
            setTimeout(() => {
                if (fireworksContainer.parentNode) {
                    fireworksContainer.parentNode.removeChild(fireworksContainer);
                }
                if (style.parentNode) {
                    style.parentNode.removeChild(style);
                }

                const endTime = performance.now();
                const totalTime = (endTime - startTime).toFixed(2);
                log(`‚úÖ Fireworks effect completed in ${totalTime}ms`, 'success');
                updateMetrics('Fireworks Effect Duration', `${totalTime}ms`);
            }, 5000);
        }

        function testFireworksEffect() {
            log('üéÜ Testing fireworks effect...');
            showFireworksEffect();
        }

        function testCompletionCelebration() {
            log('üéâ Testing completion celebration (fireworks + message)...');

            // Show a completion message first
            const completionMessages = [
                'T·∫•t c·∫£ c√¥ng vi·ªác ƒë√£ ho√†n th√†nh! üéØ',
                'B·∫°n ƒë√£ x·ª≠ l√Ω xong t·∫•t c·∫£ ticket h√¥m nay! üí™',
                'Xu·∫•t s·∫Øc! Kh√¥ng c√≤n vi·ªác g√¨ c·∫ßn l√†m! üåü',
                'Ho√†n th√†nh 100% c√¥ng vi·ªác! üèÜ'
            ];

            const message = completionMessages[Math.floor(Math.random() * completionMessages.length)];
            log(`üì¢ ${message}`, 'success');

            // Trigger fireworks after a short delay
            setTimeout(() => {
                showFireworksEffect();
            }, 500);
        }

        // AI Chat Functionality
        let chatOpen = false;

        function toggleChat() {
            const chatContainer = document.getElementById('chat-container');
            const chatIcon = document.getElementById('chat-icon');

            chatOpen = !chatOpen;

            if (chatOpen) {
                chatContainer.style.display = 'flex';
                chatIcon.style.transform = 'scale(0.9)';
                document.getElementById('chat-input').focus();
                log('ü§ñ AI Chat opened');
            } else {
                chatContainer.style.display = 'none';
                chatIcon.style.transform = 'scale(1)';
                log('ü§ñ AI Chat closed');
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (!message) return;

            // Add user message to chat
            addMessageToChat(message, 'user');
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            try {
                // Call AI API (placeholder for now)
                const response = await callAIAPI(message);

                // Hide typing indicator and add bot response
                hideTypingIndicator();
                addMessageToChat(response, 'bot');

                log(`ü§ñ AI Query: "${message}" -> Response: "${response.substring(0, 50)}..."`);

            } catch (error) {
                hideTypingIndicator();
                addMessageToChat('Sorry, I encountered an error. Please try again later.', 'bot');
                log(`‚ùå AI Error: ${error.message}`, 'error');
            }
        }

        function addMessageToChat(message, sender) {
            const messagesContainer = document.getElementById('chat-messages');

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = message;

            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'block';

            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'none';
        }

        // AI API Integration (placeholder implementation)
        async function callAIAPI(message) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));

            // For now, return a mock response based on keywords
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('ticket') || lowerMessage.includes('dashboard')) {
                return "I can help you with ticket management! The dashboard allows you to view, start, and complete tickets. You can also use templates for common responses and track your progress in real-time.";
            } else if (lowerMessage.includes('template') || lowerMessage.includes('email')) {
                return "Templates are pre-written responses that help you communicate efficiently. You can customize them with placeholders for customer names, order numbers, and other dynamic content.";
            } else if (lowerMessage.includes('notification') || lowerMessage.includes('schedule')) {
                return "The notification system keeps you updated on manual schedule assignments and important updates. You can test different notification types using the controls above.";
            } else if (lowerMessage.includes('fireworks') || lowerMessage.includes('celebration')) {
                return "The fireworks effect celebrates when you complete all your tickets! It's a fun way to acknowledge your hard work. You can test it using the buttons above.";
            } else if (lowerMessage.includes('api') || lowerMessage.includes('integration')) {
                return "For AI integration, you can use:\n\n1. **Hugging Face API**: Use their Inference API with models like GPT-2, BERT, or custom fine-tuned models\n2. **Google Colab**: Host your own model and expose it via ngrok or similar\n3. **OpenAI API**: For more advanced conversational AI\n\nWould you like specific implementation details for any of these?";
            } else if (lowerMessage.includes('help') || lowerMessage.includes('how')) {
                return "I'm here to help! I can assist with:\n‚Ä¢ Dashboard navigation\n‚Ä¢ Ticket management\n‚Ä¢ Template usage\n‚Ä¢ System features\n‚Ä¢ API integration guidance\n\nWhat specific topic would you like to know more about?";
            } else {
                return "That's an interesting question! While I'm still learning about your specific needs, I can help with dashboard features, ticket management, templates, and system integration. Could you be more specific about what you'd like to know?";
            }
        }

        // API Integration Guide
        function showAPIIntegrationGuide() {
            const guide = `
# AI API Integration Options

## 1. Hugging Face Inference API
\`\`\`javascript
const response = await fetch('https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer YOUR_HF_TOKEN',
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        inputs: userMessage,
        parameters: {
            max_length: 100,
            temperature: 0.7
        }
    })
});
\`\`\`

## 2. Google Colab + ngrok
1. Set up your model in Colab
2. Use Flask to create an API endpoint
3. Expose with ngrok for public access
4. Call from your frontend

## 3. Custom Implementation
Replace the \`callAIAPI\` function with your chosen solution.
            `;

            addMessageToChat(guide, 'bot');
        }
    </script>
</body>
</html>

